{"changed":true,"filter":false,"title":"update.php","tooltip":"/New/Alter/update.php","value":"<?php \nrequire __DIR__ . '/../../vendor/autoload.php';\nuse Aws\\S3\\S3Client;\n\n$verifyCode = getenv('SET_VERIFY');\n$onPage = $_POST[\"INTERNAL\"];\n$Update = $_POST[\"UPDATE\"];\n\nif ($verifyCode == $onPage){\n    $table = $_POST[\"table\"];\n    require '../connection.inc.php';\n        if ($Update == \"Yes\"){\n            if ($table ==\"newsupdates\"){\n                $bucket = \"OnDeckNews\";\n            // this table is being depreciated\n            } elseif ($table ==\"customertut\"){\n                $bucket = \"Testimonials\";\n            } elseif ($table ==\"specials\"){\n                $bucket = \"Specials\";\n            } elseif ($table ==\"food\"){\n                $bucket = \"Food\";\n            } elseif ($table ==\"customerpic\"){\n                $bucket = \"CustomerPics\";\n            } elseif ($table ==\"customervid\"){\n                $bucket = \"CustomerVids\";\n            }\n        } elseif ($Update == \"No\"){\n            $image = $_POST[\"IMAGE\"];\n        }  \n        if ($bucket == \"OnDeckNews\" Or $bucket == \"Testimonials\" Or $bucket == \"Specials\" Or $bucket == \"Food\" Or $bucket == \"CustomerPics\" Or $bucket == \"CustomerVids\"){\n            // Check if file was uploaded without errors\n            if(isset($_FILES[\"photo\"]) && $_FILES[\"photo\"][\"error\"] == 0){\n                $allowed = array(\"jpg\" => \"image/jpg\", \"jpeg\" => \"image/jpeg\", \"gif\" => \"image/gif\", \"png\" => \"image/png\");\n                $filename = $_FILES[\"photo\"][\"name\"];\n                $filetype = $_FILES[\"photo\"][\"type\"];\n                $filesize = $_FILES[\"photo\"][\"size\"];\n                    \n                // Verify file extension\n                $ext = pathinfo($filename, PATHINFO_EXTENSION);\n                if(!array_key_exists($ext, $allowed)) die(\"Error: Please select a valid file format.\");\n                    \n                // Verify file size - 5MB maximum\n                $maxsize = 5 * 1024 * 1024;\n                if($filesize > $maxsize) die(\"Error: File size is larger than the allowed limit.\");\n                \n                // Verify MYME type of the file\n                if(in_array($filetype, $allowed)){\n                    // Check whether file exists before uploading it\n                    if(file_exists(\"upload/\" . $_FILES[\"photo\"][\"name\"])){\n                        echo $_FILES[\"photo\"][\"name\"] . \" is already exists.\";\n                    } else{\n                        move_uploaded_file($_FILES[\"photo\"][\"tmp_name\"], \"upload/\" . $_FILES[\"photo\"][\"name\"]);\n                        echo \"Your file was uploaded successfully.\";\n                        \n                        //delete old record\n                        $secretKey = getenv('IAM_SECRET');\n                        $key = getenv('IAM_KEY');\n\n                        $s3 = S3Client::factory([\n                            'version' => 'latest',\n                            'region'  => 'us-east-2',\n                            'credentials' => array(\n                                'key' => \"$key\",\n                                'secret'  => \"$secretKey\"\n                            )]);\n                    \n                        \n                        $oldBUCKET = \"islandhoppin\";\n                        $oldIMAGE = $_POST[\"IMAGE\"];\n                        $keyname = substr($oldIMAGE, 37);\n                        $result = $s3->deleteObject(array(\n                            'Bucket' => $oldBUCKET,\n                            'Key'    => $keyname\n                        ));\n                        \n                        //set new url of record\n                        $image = \"https://dzx3g8o0zzxkn.cloudfront.net/$bucket/$filename\";\n                    } \n                } else{\n                    echo \"Error: There was a problem uploading your file. Please try again.\"; \n                }\n            } else{\n                die(\"Error: \" . $_FILES[\"photo\"][\"error\"]);\n            }\n                \n        }\n    \tif ($table == \"newsupdates\"){\n    \t\t$key = $_POST[\"id\"];\n    \t\t$header = pg_escape_string($_POST[\"Header\"]);\n    \t\t$today = pg_escape_string($_POST[\"date\"]);\n    \t\t$update = pg_escape_string($_POST[\"update\"]);\n    \t\t$query = \"UPDATE newsupdates SET header = '$header', update = '$update', image = '$image', blank_1 = '$today' WHERE news_id = $key\";\n    \t}\n    \tif ($table == \"customertut\"){\n    \t\t$key = $_POST[\"id\"];\n    \t\t$header = pg_escape_string($_POST[\"Header\"]);\n    \t\t$today = pg_escape_string($_POST[\"date\"]);\n    \t\t$update = pg_escape_string($_POST[\"update\"]);\n    \t\t$query = \"UPDATE customertut SET header = '$header', update = '$update', image = '$image', blank_1 = '$today' WHERE news_id = $key\";\n    \t}\n    \tif ($table == \"testimonials\"){\n    \t    $testimonial_id = $_POST[\"id\"];\n    \t\t$title = pg_escape_string($_POST[\"family_name\"]);\n    \t\t$headline = pg_escape_string($_POST[\"head_line\"]);\n    \t\t$testimonial = $_POST[\"testimonial_text\"];\n    \t\t$tripdate = pg_escape_string($_POST[\"date\"]);\n    \t\t$extra_space = $_POST[\"line_break\"];\n    \t\t$show = pg_escape_string($_POST[\"show\"]);\n    \t\t$query = \"UPDATE testimonials SET title = '$title', headline = '$headline', testimonial = '$testimonial', tripdate = '$tripdate', extra_space = '$extra_space', show = '$show') WHERE testimonial_id = $testimonial_id\";\n    \t}\n    \tif ($table == \"faqList\"){\n    \t\t$faq_id = $_POST[\"faq_id\"];\n    \t\t$question = pg_escape_string($_POST[\"question\"]);\n    \t\t$answer = pg_escape_string($_POST[\"answer\"]);\n    \t\t$faqorder = $_POST[\"faqorder\"];\n    \t\t$show = pg_escape_string($_POST[\"show\"]);\n    \t\t$today = $_POST[\"blank_1\"];\n    \t\t$query = \"UPDATE faqList SET question = '$question', answer = '$answer', faqorder = '$faqorder', show = '$show', blank_1 = '$today' WHERE faq_id = $faq_id\";\n    \t}\n    \tif ($table == \"priceSchedule\"){\n    \t\t$price_id = $_POST[\"price_id\"];\n    \t\t$season = pg_escape_string($_POST[\"season\"]);\n    \t\t$twopax = pg_escape_string($_POST[\"twopax\"]);\n    \t\t$threepax = pg_escape_string($_POST[\"threepax\"]);\n    \t\t$fourpax = pg_escape_string($_POST[\"fourpax\"]);\n    \t\t$fivepax = pg_escape_string($_POST[\"fivepax\"]);\n    \t\t$sixpax = pg_escape_string($_POST[\"sixpax\"]);\n    \t\t$sevenpax = pg_escape_string($_POST[\"sevenpax\"]);\n    \t\t$eightpax = pg_escape_string($_POST[\"eightpax\"]);\n    \t\t$show = $_POST[\"show\"];\n    \t\t$query = \"UPDATE priceSchedule SET season = '$season', twopax = '$twopax', threepax = '$threepax', fourpax = '$fourpax', fivepax = '$fivepax', sixpax = '$sixpax', sevenpax = '$sevenpax', eightpax = '$eightpax', show = '$show' WHERE price_id = $price_id\";\n    \t}\n    \tif ($table == \"specials\"){\n    \t\t$key = $_POST[\"id\"];\n    \t\t$specialTitle = pg_escape_string($_POST[\"specialTitle\"]);\n    \t\t$offer = pg_escape_string($_POST[\"offer\"]);\n    \t\t$today = pg_escape_string($_POST[\"date\"]);\n    \t\t$specialorder = $_POST[\"specialorder\"];\n    \t\t$show = pg_escape_string($_POST[\"show\"]);\n    \t\t$query = \"UPDATE specials SET special_title = '$specialTitle', offer = '$offer', special_order = '$specialorder', show = '$show', image = '$image', blank_1 = '$today' WHERE special_id = $key\";\n    \t}\n    \tif ($table == \"food\"){\n    \t\t$key = $_POST[\"id\"];\n    \t\t$foodTitle = pg_escape_string($_POST[\"foodTitle\"]);\n    \t\t$today = pg_escape_string($_POST[\"date\"]);\n    \t\t$show = pg_escape_string($_POST[\"show\"]);\n    \t\t$query = \"UPDATE food SET food_title = '$foodTitle', show = '$show', image = '$image', blank_1 = '$today' WHERE food_id = $key\";\n    \t}\n    \tif ($table == \"customerpic\"){\n    \t\t$key = $_POST[\"id\"];\n    \t\t$picTitle = pg_escape_string($_POST[\"picTitle\"]);\n    \t\t$today = pg_escape_string($_POST[\"date\"]);\n    \t\t$show = pg_escape_string($_POST[\"show\"]);\n    \t\t$query = \"UPDATE customerpic SET pic_title = '$picTitle', show = '$show', image = '$image', blank_1 = '$today' WHERE pic_id = $key\";\n    \t}\n    \tif ($table == \"customervid\"){\n    \t\t$key = $_POST[\"id\"];\n    \t\t$video_link = $_POST[\"video_link\"];\n    \t\t$vidTitle = pg_escape_string($_POST[\"vidTitle\"]);\n    \t\t$today = pg_escape_string($_POST[\"date\"]);\n    \t\t$show = pg_escape_string($_POST[\"show\"]);\n    \t\t$query = \"UPDATE customervid SET vid_title = '$vidTitle', show = '$show', video_link = '$video_link', image = '$image', blank_1 = '$today' WHERE vid_id = $key\";\n    \t}\n    $dbconn->query($query);\n}\nif ($bucket == \"OnDeckNews\" Or $bucket == \"Testimonials\" Or $bucket == \"Specials\" Or $bucket == \"Food\" Or $bucket == \"CustomerPics\" Or $bucket == \"CustomerVids\"){\n    $subids = Array\n    (\n        'BUCKET' => $bucket,\n        'FILENAME' => $filename,\n        'CONTENT' => $filetype,\n        'INTERNAL' => $onPage\n    );\n            header(\"Location: /New/Alter/uploadPhoto.php?\".http_build_query($subids));\n} else header('Location: ../Content.php?INTERNAL='.$onPage);\n\n?>\n","undoManager":{"mark":15,"position":17,"stack":[[{"start":{"row":100,"column":31},"end":{"row":100,"column":32},"action":"insert","lines":["s"],"id":84}],[{"start":{"row":105,"column":11},"end":{"row":105,"column":12},"action":"remove","lines":["y"],"id":85},{"start":{"row":105,"column":10},"end":{"row":105,"column":11},"action":"remove","lines":["a"]},{"start":{"row":105,"column":9},"end":{"row":105,"column":10},"action":"remove","lines":["d"]},{"start":{"row":105,"column":8},"end":{"row":105,"column":9},"action":"remove","lines":["o"]},{"start":{"row":105,"column":7},"end":{"row":105,"column":8},"action":"remove","lines":["t"]}],[{"start":{"row":105,"column":7},"end":{"row":105,"column":8},"action":"insert","lines":["d"],"id":86},{"start":{"row":105,"column":8},"end":{"row":105,"column":9},"action":"insert","lines":["a"]},{"start":{"row":105,"column":9},"end":{"row":105,"column":10},"action":"insert","lines":["t"]},{"start":{"row":105,"column":10},"end":{"row":105,"column":11},"action":"insert","lines":["e"]}],[{"start":{"row":108,"column":124},"end":{"row":108,"column":125},"action":"remove","lines":["y"],"id":87},{"start":{"row":108,"column":123},"end":{"row":108,"column":124},"action":"remove","lines":["a"]},{"start":{"row":108,"column":122},"end":{"row":108,"column":123},"action":"remove","lines":["d"]},{"start":{"row":108,"column":121},"end":{"row":108,"column":122},"action":"remove","lines":["o"]},{"start":{"row":108,"column":120},"end":{"row":108,"column":121},"action":"remove","lines":["t"]}],[{"start":{"row":108,"column":120},"end":{"row":108,"column":121},"action":"insert","lines":["d"],"id":88},{"start":{"row":108,"column":121},"end":{"row":108,"column":122},"action":"insert","lines":["a"]},{"start":{"row":108,"column":122},"end":{"row":108,"column":123},"action":"insert","lines":["t"]},{"start":{"row":108,"column":123},"end":{"row":108,"column":124},"action":"insert","lines":["e"]}],[{"start":{"row":108,"column":111},"end":{"row":108,"column":115},"action":"remove","lines":["date"],"id":89},{"start":{"row":108,"column":111},"end":{"row":108,"column":119},"action":"insert","lines":["tripdate"]}],[{"start":{"row":108,"column":124},"end":{"row":108,"column":125},"action":"insert","lines":["t"],"id":90},{"start":{"row":108,"column":125},"end":{"row":108,"column":126},"action":"insert","lines":["r"]},{"start":{"row":108,"column":126},"end":{"row":108,"column":127},"action":"insert","lines":["i"]},{"start":{"row":108,"column":127},"end":{"row":108,"column":128},"action":"insert","lines":["p"]}],[{"start":{"row":105,"column":7},"end":{"row":105,"column":8},"action":"insert","lines":["t"],"id":91},{"start":{"row":105,"column":8},"end":{"row":105,"column":9},"action":"insert","lines":["r"]},{"start":{"row":105,"column":9},"end":{"row":105,"column":10},"action":"insert","lines":["i"]},{"start":{"row":105,"column":10},"end":{"row":105,"column":11},"action":"insert","lines":["p"]}],[{"start":{"row":105,"column":6},"end":{"row":105,"column":15},"action":"remove","lines":["$tripdate"],"id":92},{"start":{"row":105,"column":6},"end":{"row":105,"column":15},"action":"insert","lines":["$tripdate"]}],[{"start":{"row":108,"column":57},"end":{"row":108,"column":58},"action":"insert","lines":["$"],"id":93}],[{"start":{"row":108,"column":57},"end":{"row":108,"column":58},"action":"remove","lines":["$"],"id":94}],[{"start":{"row":100,"column":20},"end":{"row":100,"column":21},"action":"remove","lines":["t"],"id":95}],[{"start":{"row":100,"column":20},"end":{"row":100,"column":21},"action":"insert","lines":["T"],"id":96}],[{"start":{"row":100,"column":20},"end":{"row":100,"column":21},"action":"remove","lines":["T"],"id":97}],[{"start":{"row":100,"column":20},"end":{"row":100,"column":21},"action":"insert","lines":["t"],"id":98}],[{"start":{"row":108,"column":34},"end":{"row":108,"column":35},"action":"insert","lines":["s"],"id":99}],[{"start":{"row":108,"column":220},"end":{"row":108,"column":221},"action":"remove","lines":["\""],"id":100}],[{"start":{"row":108,"column":220},"end":{"row":108,"column":221},"action":"insert","lines":["\""],"id":101}]]},"ace":{"folds":[],"scrolltop":1399.5,"scrollleft":371.5,"selection":{"start":{"row":108,"column":221},"end":{"row":108,"column":221},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":68,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1564344565754}